# 11 Билет

## Теория 

**Принципы взаимодействия операционной системы с прикладными программами (в том числе раскрыть понятия “процесс”, “поток”, “дескриптор”)**

 Операционная система выступает посредником между программами и аппаратными ресурсами компьютера. Ее задача — контролировать доступ к оборудованию, обеспечивать надежную работу множества программ одновременно и поддерживать стабильную среду выполнения.

формирует иерархию сущностей, главными из которых являются процессы, потоки и дескрипторы.

1. Процесс

Процесс — это запущенная программа, занимающая определенное пространство в памяти и обладающая своими ресурсами (файлами, сетевыми соединениями, памятью и прочими).

Процесс включает в себя:

1.       Исполняемый код программы.
2.       Рабочую память (stack, heap).
3.       Таблицу открытых файлов и соединений.
4.       Идентификационный номер (PID — process identifier).

Главная особенность процесса — полная изоляция от других процессов. Одно приложение не может напрямую вмешиваться в работу другого, если специально не предусмотрено совместное использование ресурсов.

2. Поток

Поток — это единица выполнения внутри процесса. В отличие от процесса, потоки разделяют одно адресное пространство и ресурсы, что позволяет нескольким участкам программы выполняться одновременно. Потоки могут общаться между собой напрямую, поскольку находятся в одном пространстве памяти.

Важно помнить, что хотя потоки используют общие ресурсы, они выполняются независимо друг от друга, что может приводить к конфликтам (например, гонке данных), если они неправильно организованы.

3. Дескриптор

Дескриптор — это особый идентификатор, выданный операционной системой для обозначения открытого ресурса (файла, устройства, сокета и т.д.). Представляет собой уникальное число, ассоциированное с определенным объектом.

Когда программа открывает файл, ОС выдает ей дескриптор, который программа далее использует для работы с данным файлом. Например, если вы открываете файл, ОС присвоит ему дескриптор (например, число 0x00000488), и дальше все операции (чтение, запись, закрытие) проводятся через этот дескриптор.

Как взаимодействуют программы и ОС?

Вся связь между прикладными программами и операционной системой строится на системных вызовах. Программы вызывают специальные функции ядра ОС, чтобы выполнить необходимые действия:

1.       Открытие файла: open()
2.       Создание процесса: fork()
3.       Чтение из файла: read()
4.       Завершение программы: exit()

Таким образом, взаимодействие происходит поэтапно:
1.       Программа просит ОС открыть файл (системный вызов).
2.       ОС проверяет права доступа и, если разрешено, возвращает дескриптор.
3.       Программа пользуется этим дескриптором для дальнейшей работы с файлом.

## Практика
Создание программы с критической секцией в ОС Windows. Программа должна содержать минимум два потока. Использование критической секции в функции потока должно быть обосновано.

Шаг 1. Создать следующий код в main.c файле  

``` C
#include <Windows.h>
#include <stdio.h>

int sharedCount = 0;
CRITICAL_SECTION section = { 0 };

DWORD WINAPI ThreadFunc() {
	for (int i = 0; i < 10000000; i++) {
		EnterCriticalSection(&section);
		sharedCount++;
		LeaveCriticalSection(&section);
	}
	return 0;
}

int main() {
	system("chcp 1251");
	InitializeCriticalSection(&section);
	HANDLE hF[3];
	hF[0] = CreateThread(0, 0, ThreadFunc, 0, 0, 0);
	hF[1] = CreateThread(0, 0, ThreadFunc, 0, 0, 0);
	hF[2] = CreateThread(0, 0, ThreadFunc, 0, 0, 0);
	
	WaitForMultipleObjects(3, hF, TRUE, INFINITE);
	printf("%d", sharedCount);
	DeleteCriticalSection(&section);
	
	return 0;
}
```

Если закомментировать критическую секцию, то значение переменной будет иным.