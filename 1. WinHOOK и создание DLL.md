# 1 Билет
## Теория
**Windows** HOOK. Назначение и особенности использования  
Windows Hook — механизм перехвата системных событий Windows, который позволяет программе «подслушивать» действия ОС.

Основные типы перехватываемых событий

1.       Клавиатурные события: перехват нажатия клавиш, горячих комбинаций.

2.       События мыши: отслеживание движений, щелчков кнопок мыши.

3.       Сообщения окна: изменения размеров, положения, состояния окон приложений.

4.       Фокус ввода: переключение активного окна, потеря фокуса.

5.       Другие специфичные события: тайминги, работа таймера, выход из системы и др.

Живой пример:

 Ты ставишь _глобальный хук на нажатие клавиш_ — и можешь:

• ловить комбинации «горячих клавиш» своей программой (например, Ctrl+Shift+Q → быстро открыть заметки),

• делать программу, реагирующую на каждую клавишу. Или хук мыши программа может ловить все клики в системе.

Особенности:

• глобальные хуки работают для всех программ, но должны быть в DLL; 
• могут замедлять систему, если обрабатывать много событий;
• требуют аккуратности — можно повесить весь рабочий стол.

## Практика
Создание и отладка библиотеки DLL. Для демонстрации работы написать две элементарные функции в библиотеке и вызвать их из основной программы.

Шаг 1. Код в файле main.c (консольное приложение)

``` C

#include <Windows.h>
#include <stdio.h>
#define PATH L"DllProject.dll" // путь к DLL

typedef int(*Fun)(int, int); // Объявление типа указателя на функцию

// main функция 
int main() {
	HINSTANCE dll; // дескриптор загруженной DLL

	if ((dll = LoadLibrary(PATH)) == NULL) return 1; // проверка 

	// Получение адресов функций из DLL
	Fun Sum = GetProcAddress(dll, "Sum");
	Fun Diff = GetProcAddress(dll, "Diff");

	// вызов функций в консоль
	printf("%d\n", Sum(2, 1));
	printf("%d\n", Diff(2, 1));

	// очистка дескриптора 
	FreeLibrary(dll); 

	return 0;
}
```

Шаг 2. Код в файле DllCode.c в проекте одного решения DllProject.  
``` C

#include <Windows.h>

// точка входа в DLL
BOOL WINAPI DllMain() {
	return TRUE;
}

// пометка функций на экспорт
__declspec(dllexport) int Sum(int a, int b);

// функция для экспорта
int Sum(int a, int b){
	return a + b;
}

__declspec(dllexport) int Diff(int a, int b);

int Diff(int a, int b) {
	return a - b;
}

```

Шаг 3. Укажем проекту с dll то, что он должен компилировать под dll.
Свойства -> Главное -> Тип конфигурации -> Dll
![Описание изображения](assets/Pasted%20image%2020251225211552.png)
<br>

Шаг 4. Скомпилируем dll и запустим главный проект.<br>
![Описание изображения](assets/Pasted%20image%2020251225211655.png)
<br>

При компиляции должна появиться такая ошибка <br>
![Описание картинки](assets/Pasted%20image%2020251225211725.png)
<br>

Запуск проекта Project1 выведет следующее в консоль, что говорит о работоспособности программы и DLL. <br>
![Описание картинки](assets/Pasted%20image%2020251225211814.png)
<br>